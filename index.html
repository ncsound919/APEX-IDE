<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>APEX IDE ‚Äî Megacode Edition</title>
  <link rel="stylesheet" href="src/styles.css" />
  <!-- Monaco Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
</head>
<body>
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING WIZARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="onboarding-overlay" class="onboarding-overlay">
    <div class="onboarding-modal">
      <div class="onboarding-header">
        <span class="apex-logo">‚¨° APEX</span>
        <span class="onboarding-tagline">MEGACODE EDITION</span>
      </div>
      <div class="onboarding-steps">
        <!-- Step 1 -->
        <div class="onboarding-step active" id="step-1">
          <h2>Welcome to APEX IDE üé§</h2>
          <p>The hip-hop powered desktop IDE for elite coders. Let's get you set up.</p>
          <div class="form-group">
            <label>Your Name / Handle</label>
            <input type="text" id="user-handle" placeholder="e.g. NCSoundKing" />
          </div>
          <div class="form-group">
            <label>Mode</label>
            <div class="mode-toggle">
              <button class="mode-btn active" data-mode="rookie" onclick="selectMode('rookie',this)">ü•ä Rookie</button>
              <button class="mode-btn" data-mode="expert" onclick="selectMode('expert',this)">üî• Expert</button>
            </div>
          </div>
          <button class="btn-primary" onclick="nextStep(2)">Next ‚Ä∫</button>
        </div>
        <!-- Step 2 -->
        <div class="onboarding-step" id="step-2">
          <h2>LLM Provider Keys üîë</h2>
          <p>Connect your AI providers. Keys are stored locally ‚Äî never sent to our servers.</p>
          <div class="form-group">
            <label>OpenAI API Key</label>
            <input type="password" id="key-openai" placeholder="sk-..." />
          </div>
          <div class="form-group">
            <label>Anthropic (Claude) API Key</label>
            <input type="password" id="key-anthropic" placeholder="sk-ant-..." />
          </div>
          <div class="form-group">
            <label>DeepSeek API Key</label>
            <input type="password" id="key-deepseek" placeholder="ds-..." />
          </div>
          <div class="form-group">
            <label>Ollama Endpoint (local)</label>
            <input type="text" id="key-ollama" placeholder="http://localhost:11434" value="http://localhost:11434" />
          </div>
          <div class="btn-row">
            <button class="btn-secondary" onclick="nextStep(1)">‚Äπ Back</button>
            <button class="btn-primary" onclick="nextStep(3)">Next ‚Ä∫</button>
          </div>
        </div>
        <!-- Step 3 -->
        <div class="onboarding-step" id="step-3">
          <h2>Import Your Project üìÅ</h2>
          <p>Load an existing project or start fresh.</p>
          <div class="form-group">
            <label>Project Name</label>
            <input type="text" id="project-name" placeholder="e.g. Overlay365, Cheetah" />
          </div>
          <div class="form-group">
            <label>Project Type</label>
            <select id="project-type">
              <option value="general">General / Full-Stack</option>
              <option value="music">üéµ Music Production</option>
              <option value="biotech">üß¨ Biotech / Research</option>
              <option value="graphic-novel">üé® Graphic Novels / NFTs</option>
            </select>
          </div>
          <div class="btn-row">
            <button class="btn-secondary" onclick="nextStep(2)">‚Äπ Back</button>
            <button class="btn-primary" onclick="finishOnboarding()">Launch APEX üöÄ</button>
          </div>
        </div>
      </div>
      <div class="onboarding-progress">
        <span class="dot active" onclick="nextStep(1)"></span>
        <span class="dot" onclick="nextStep(2)"></span>
        <span class="dot" onclick="nextStep(3)"></span>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="app" class="app hidden">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topbar-left">
        <span class="apex-logo-small">‚¨° APEX</span>
        <nav class="menu-bar">
          <button class="menu-item" onclick="openMenu('file')">File</button>
          <button class="menu-item" onclick="openMenu('edit')">Edit</button>
          <button class="menu-item" onclick="openMenu('view')">View</button>
          <button class="menu-item" onclick="openMenu('run')">Run</button>
          <button class="menu-item" onclick="openMenu('megacode')">Megacode</button>
        </nav>
      </div>
      <div class="topbar-center">
        <div class="search-bar" onclick="openCommandPalette()">
          <span class="search-icon">‚åò</span>
          <span class="search-placeholder">Search files, commands‚Ä¶ (Ctrl+P)</span>
        </div>
      </div>
      <div class="topbar-right">
        <div class="provider-status" id="provider-status">
          <span class="provider-dot green" title="OpenAI Online"></span>
          <span class="provider-dot green" title="Claude Online"></span>
          <span class="provider-dot yellow" title="DeepSeek Degraded"></span>
          <span class="provider-dot red" title="Ollama Offline"></span>
        </div>
        <button class="topbar-btn" onclick="togglePanel('vibe-layer')" title="Vibe Layer">üéØ</button>
        <button class="topbar-btn" onclick="togglePanel('monetization')" title="Monetization">üí∞</button>
        <span class="user-badge" id="user-badge">üë§ User</span>
        <button class="topbar-btn mode-indicator" id="mode-indicator" onclick="toggleExpertMode()" title="Toggle Mode">ü•ä Rookie</button>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="workspace">
      <!-- ACTIVITY BAR (left) -->
      <aside class="activity-bar">
        <button class="activity-btn active" data-panel="explorer" onclick="switchActivity('explorer',this)" title="File Explorer">üìÅ</button>
        <button class="activity-btn" data-panel="search" onclick="switchActivity('search',this)" title="Search">üîç</button>
        <button class="activity-btn" data-panel="git" onclick="switchActivity('git',this)" title="Git">‚éá</button>
        <button class="activity-btn" data-panel="chat" onclick="switchActivity('chat',this)" title="AI Chat">üí¨</button>
        <button class="activity-btn" data-panel="llm-router" onclick="switchActivity('llm-router',this)" title="LLM Router">üß†</button>
        <button class="activity-btn" data-panel="ide-bridge" onclick="switchActivity('ide-bridge',this)" title="IDE Bridge">‚ö°</button>
        <button class="activity-btn" data-panel="domains" onclick="switchActivity('domains',this)" title="Domain Adapters">üéõÔ∏è</button>
        <button class="activity-btn" data-panel="cli" onclick="switchActivity('cli',this)" title="CLI Runner">üíª</button>
        <button class="activity-btn" data-panel="mcp" onclick="switchActivity('mcp',this)" title="MCP Servers">üîå</button>
        <button class="activity-btn" data-panel="music-player" onclick="switchActivity('music-player',this)" title="Music Player">üéµ</button>
        <div class="activity-spacer"></div>
        <button class="activity-btn" data-panel="settings" onclick="switchActivity('settings',this)" title="Settings">‚öôÔ∏è</button>
      </aside>

      <!-- SIDEBAR PANELS -->
      <aside class="sidebar" id="sidebar">
        <!-- File Explorer Panel -->
        <div class="panel active" id="panel-explorer">
          <div class="panel-header">
            <span>EXPLORER</span>
            <div class="panel-actions">
              <button class="icon-btn" onclick="newFile()" title="New File">üìÑ+</button>
              <button class="icon-btn" onclick="newFolder()" title="New Folder">üìÅ+</button>
              <button class="icon-btn" onclick="refreshExplorer()" title="Refresh">‚Üª</button>
            </div>
          </div>
          <div class="file-tree" id="file-tree"></div>
        </div>

        <!-- Search Panel -->
        <div class="panel" id="panel-search">
          <div class="panel-header"><span>SEARCH</span></div>
          <div class="search-input-group">
            <input type="text" class="search-input" id="search-query" placeholder="Search in files‚Ä¶" oninput="runSearch(this.value)" />
            <label class="search-option"><input type="checkbox" id="search-regex" /> Regex</label>
            <label class="search-option"><input type="checkbox" id="search-case" /> Match Case</label>
          </div>
          <div class="search-results" id="search-results"><p class="empty-state">Type to search‚Ä¶</p></div>
        </div>

        <!-- Git Panel -->
        <div class="panel" id="panel-git">
          <div class="panel-header"><span>SOURCE CONTROL</span></div>
          <div class="git-status" id="git-status">
            <div class="git-section">
              <div class="git-section-header">CHANGES (3)</div>
              <div class="git-file modified">M src/app.js</div>
              <div class="git-file added">A src/new-feature.js</div>
              <div class="git-file deleted">D old-file.js</div>
            </div>
          </div>
          <div class="git-commit">
            <input type="text" class="commit-input" placeholder="Commit message (Ctrl+Enter)" />
            <button class="btn-commit" onclick="gitCommit()">‚úì Commit</button>
          </div>
          <div class="git-actions">
            <button class="git-action-btn" onclick="gitPull()">‚Üì Pull</button>
            <button class="git-action-btn" onclick="gitPush()">‚Üë Push</button>
            <button class="git-action-btn" onclick="gitBranch()">‚éá Branch</button>
          </div>
        </div>

        <!-- LLM Router Panel -->
        <div class="panel" id="panel-llm-router">
          <div class="panel-header"><span>LLM ROUTER</span></div>
          <div class="llm-router-panel">
            <div class="router-section">
              <div class="section-label">PROVIDER HEALTH</div>
              <div class="provider-card online">
                <div class="provider-name">OpenAI GPT-4o</div>
                <div class="provider-stats">
                  <span class="stat-pill green">‚óè Online</span>
                  <span class="stat-val">124ms</span>
                </div>
              </div>
              <div class="provider-card online">
                <div class="provider-name">Claude 3.5 Sonnet</div>
                <div class="provider-stats">
                  <span class="stat-pill green">‚óè Online</span>
                  <span class="stat-val">89ms</span>
                </div>
              </div>
              <div class="provider-card degraded">
                <div class="provider-name">DeepSeek Coder</div>
                <div class="provider-stats">
                  <span class="stat-pill yellow">‚óè Degraded</span>
                  <span class="stat-val">412ms</span>
                </div>
              </div>
              <div class="provider-card offline">
                <div class="provider-name">Ollama (Local)</div>
                <div class="provider-stats">
                  <span class="stat-pill red">‚óè Offline</span>
                  <button class="failover-btn" onclick="startOllama()">Start</button>
                </div>
              </div>
            </div>
            <div class="router-section">
              <div class="section-label">CACHE HIT RATE</div>
              <div class="cache-bar-wrap">
                <div class="cache-label">Prompt Cache</div>
                <div class="progress-bar"><div class="progress-fill" style="width:67%"></div></div>
                <span class="progress-val">67%</span>
              </div>
              <div class="cache-bar-wrap">
                <div class="cache-label">Response Cache</div>
                <div class="progress-bar"><div class="progress-fill amber" style="width:43%"></div></div>
                <span class="progress-val">43%</span>
              </div>
            </div>
            <div class="router-section">
              <div class="section-label">TOKEN USAGE (TODAY)</div>
              <div class="token-usage-chart" id="token-chart"></div>
              <div class="token-totals">
                <span>Input: <strong>1.2M</strong></span>
                <span>Output: <strong>340K</strong></span>
                <span>Cost: <strong>$4.18</strong></span>
              </div>
            </div>
            <div class="router-section">
              <div class="section-label">FAILOVER</div>
              <label class="toggle-row">
                <span>Auto-failover</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
              <label class="toggle-row">
                <span>Offline-first (Ollama)</span>
                <input type="checkbox" class="toggle-switch" />
              </label>
            </div>
          </div>
        </div>

        <!-- IDE Bridge Hub Panel -->
        <div class="panel" id="panel-ide-bridge">
          <div class="panel-header"><span>IDE BRIDGE HUB</span></div>
          <div class="ide-bridge-panel">
            <div class="bridge-section">
              <div class="section-label">ACTIVE BRIDGES</div>
              <div class="bridge-card active">
                <span class="bridge-icon">üíô</span>
                <div class="bridge-info">
                  <div class="bridge-name">VSCode</div>
                  <div class="bridge-status">Connected ¬∑ Port 9742</div>
                </div>
                <button class="bridge-toggle on" onclick="toggleBridge('vscode',this)">ON</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">‚ö´</span>
                <div class="bridge-info">
                  <div class="bridge-name">Zed</div>
                  <div class="bridge-status">Inactive</div>
                </div>
                <button class="bridge-toggle off" onclick="toggleBridge('zed',this)">OFF</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">üü£</span>
                <div class="bridge-info">
                  <div class="bridge-name">Cursor</div>
                  <div class="bridge-status">Inactive</div>
                </div>
                <button class="bridge-toggle off" onclick="toggleBridge('cursor',this)">OFF</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">üî¥</span>
                <div class="bridge-info">
                  <div class="bridge-name">JetBrains (HTTP Proxy)</div>
                  <div class="bridge-status">Port 9744</div>
                </div>
                <button class="bridge-toggle off" onclick="toggleBridge('jetbrains',this)">OFF</button>
              </div>
            </div>
            <div class="bridge-section">
              <div class="section-label">QUALITY SCORES (LIVE)</div>
              <div class="quality-scores" id="quality-scores">
                <div class="quality-row">
                  <span class="quality-file">src/app.js</span>
                  <div class="quality-bar-wrap">
                    <div class="quality-bar" style="width:88%"></div>
                  </div>
                  <span class="quality-val">88</span>
                </div>
                <div class="quality-row">
                  <span class="quality-file">src/router.js</span>
                  <div class="quality-bar-wrap">
                    <div class="quality-bar amber" style="width:62%"></div>
                  </div>
                  <span class="quality-val">62</span>
                </div>
              </div>
            </div>
            <div class="bridge-section">
              <div class="section-label">INSPIRED WORKFLOWS</div>
              <div class="bridge-card">
                <span class="bridge-icon">üü£</span>
                <div class="bridge-info">
                  <div class="bridge-name">Cursor Composer Flow</div>
                  <div class="bridge-status">Agentic planning + fast apply loop</div>
                </div>
                <button class="bridge-toggle off" onclick="runInspiredFeature('cursor-composer')">RUN</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">üß≤</span>
                <div class="bridge-info">
                  <div class="bridge-name">Antigravity Context Orbit</div>
                  <div class="bridge-status">Pull related files/symbols around active code</div>
                </div>
                <button class="bridge-toggle off" onclick="runInspiredFeature('antigravity-orbit')">RUN</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">üíô</span>
                <div class="bridge-info">
                  <div class="bridge-name">VSCode Command Brain</div>
                  <div class="bridge-status">Command palette + shortcut recommendation layer</div>
                </div>
                <button class="bridge-toggle off" onclick="runInspiredFeature('vscode-command-brain')">RUN</button>
              </div>
              <div class="bridge-card">
                <span class="bridge-icon">üåä</span>
                <div class="bridge-info">
                  <div class="bridge-name">Windsurf Flow Mode</div>
                  <div class="bridge-status">Plan, execute, and checkpoint in one stream</div>
                </div>
                <button class="bridge-toggle off" onclick="runInspiredFeature('windsurf-flow')">RUN</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Domain Adapters Panel -->
        <div class="panel" id="panel-domains">
          <div class="panel-header"><span>DOMAIN ADAPTERS</span></div>
          <div class="domain-tabs">
            <button class="domain-tab active" onclick="switchDomain('music',this)">üéµ Music</button>
            <button class="domain-tab" onclick="switchDomain('biotech',this)">üß¨ Biotech</button>
            <button class="domain-tab" onclick="switchDomain('gfx',this)">üé® GFX</button>
          </div>
          <!-- Music -->
          <div class="domain-content active" id="domain-music">
            <div class="section-label">MUSIC PRODUCTION</div>
            <button class="domain-action-btn" onclick="runTool('daw-scaffold')">üéπ DAW Plugin Scaffolder</button>
            <button class="domain-action-btn" onclick="runTool('audio-preview')">üîä Audio Preview (WebAudio)</button>
            <button class="domain-action-btn" onclick="runTool('beat-runner')">ü•Å Beat Script Runner (Ollama)</button>
            <div class="audio-visualizer" id="audio-visualizer">
              <canvas id="audio-canvas" width="200" height="60"></canvas>
            </div>
          </div>
          <!-- Biotech -->
          <div class="domain-content" id="domain-biotech">
            <div class="section-label">BIOTECH / RESEARCH</div>
            <button class="domain-action-btn" onclick="runTool('smiles')">‚öóÔ∏è PubChem/SMILES Visualizer</button>
            <button class="domain-action-btn" onclick="runTool('histotripsy')">üß† Histotripsy Sim Console</button>
            <button class="domain-action-btn" onclick="runTool('mutracker')">üî¨ Mutation Tracker (MuTracker)</button>
            <div class="smiles-preview" id="smiles-preview">
              <div class="empty-state">Enter SMILES string to visualize‚Ä¶</div>
            </div>
          </div>
          <!-- Graphic Novels -->
          <div class="domain-content" id="domain-gfx">
            <div class="section-label">GRAPHIC NOVELS / NFTs</div>
            <button class="domain-action-btn" onclick="runTool('nft-mint')">ü™ô NFT Mint Preview</button>
            <button class="domain-action-btn" onclick="runTool('panel-editor')">üñºÔ∏è Panel Layout Editor</button>
            <button class="domain-action-btn" onclick="runTool('gemini-vision')">üëÅÔ∏è Gemini Vision Storyboard</button>
          </div>
        </div>

        <!-- CLI Runner Panel -->
        <div class="panel" id="panel-cli">
          <div class="panel-header"><span>CLI RUNNER</span></div>
          <div class="cli-panel">
            <div class="cli-section">
              <div class="section-label">CLI INSTANCES</div>
              <div class="cli-instance-list" id="cli-instance-list"></div>
              <div class="mcp-add-form" style="margin-top:8px">
                <input type="text" class="mcp-input" id="cli-instance-name" placeholder="CLI instance name‚Ä¶" />
                <div class="mcp-folder-row">
                  <span class="mcp-folder-label-text">üìÅ Folder</span>
                  <label class="mcp-folder-pick-btn" for="cli-instance-folder">
                    Browse
                  </label>
                  <input type="file" id="cli-instance-folder" style="display:none" webkitdirectory multiple
                         onchange="document.getElementById('cli-instance-folder-name').textContent=this.files.length?this.files[0].webkitRelativePath.split('/')[0]:'No folder selected'" />
                  <span class="mcp-folder-name" id="cli-instance-folder-name">No folder selected</span>
                </div>
                <button class="btn-primary mcp-add-btn" onclick="addCLIInstance()">+ Add CLI</button>
              </div>
            </div>
            <div class="cli-section">
              <div class="section-label">FRONTEND QUICK COMMANDS</div>
              <button class="cli-quick-btn" onclick="runCLICommand('npm install')">üì¶ npm install</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npm run dev')">üöÄ npm run dev</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npm run build')">üî® npm run build</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npm run test')">‚úÖ npm run test</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npm run lint')">üîç npm run lint</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npx vite')">‚ö° npx vite</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npx create-react-app .')">‚öõÔ∏è create-react-app</button>
              <button class="cli-quick-btn" onclick="runCLICommand('npx create-next-app .')">‚ñ≤ create-next-app</button>
            </div>
            <div class="cli-section">
              <div class="section-label">CUSTOM COMMAND</div>
              <div class="cli-input-row">
                <input type="text" class="cli-input" id="cli-custom-input"
                       placeholder="Enter CLI command‚Ä¶"
                       autocomplete="off" spellcheck="false"
                       onkeydown="handleCLIKey(event)" />
                <button class="cli-run-btn" onclick="submitCLIInput()">‚ñ∂</button>
              </div>
            </div>
            <div class="cli-section">
              <div class="section-label">OUTPUT <button class="cli-clear-btn" onclick="clearCLIOutput()">Clear</button></div>
              <div class="cli-output" id="cli-output">
                <div class="cli-line info">CLI Runner ready. Select a quick command or type below.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- MCP Servers Panel -->
        <div class="panel" id="panel-mcp">
          <div class="panel-header"><span>MCP SERVERS</span></div>
          <div class="mcp-panel">
            <div class="mcp-section">
              <div class="section-label">CONNECTED SERVERS</div>
              <div class="mcp-server-list" id="mcp-server-list">
              </div>
            </div>
            <div class="mcp-section">
              <div class="section-label">ADD SERVER</div>
              <div class="mcp-add-form">
                <input type="text" class="mcp-input" id="mcp-server-name" placeholder="Server name‚Ä¶" />
                <input type="text" class="mcp-input" id="mcp-server-cmd" placeholder="Command or URL‚Ä¶" />
                <div class="mcp-folder-row">
                  <span class="mcp-folder-label-text">üìÅ Folder</span>
                  <label class="mcp-folder-pick-btn" for="mcp-server-folder">
                    Browse
                  </label>
                  <input type="file" id="mcp-server-folder" style="display:none" webkitdirectory multiple
                         onchange="document.getElementById('mcp-server-folder-name').textContent=this.files.length?this.files[0].webkitRelativePath.split('/')[0]:'No folder selected'" />
                  <span class="mcp-folder-name" id="mcp-server-folder-name">No folder selected</span>
                </div>
                <button class="btn-primary mcp-add-btn" onclick="addMCPServer()">+ Add Server</button>
              </div>
            </div>
            <div class="mcp-section">
              <div class="section-label">AVAILABLE TOOLS</div>
              <div class="mcp-tools-list" id="mcp-tools-list">
                <div class="mcp-tool-item" role="button" tabindex="0" onclick="invokeMCPTool('read_file')"
                     onkeypress="if(event.key==='Enter'||event.key===' '){event.preventDefault();invokeMCPTool('read_file')}">
                  <span class="mcp-tool-icon">üìñ</span>
                  <div class="mcp-tool-info">
                    <div class="mcp-tool-name">read_file</div>
                    <div class="mcp-tool-desc">Read contents of a file</div>
                  </div>
                </div>
                <div class="mcp-tool-item" role="button" tabindex="0" onclick="invokeMCPTool('write_file')"
                     onkeypress="if(event.key==='Enter'||event.key===' '){event.preventDefault();invokeMCPTool('write_file')}">
                  <span class="mcp-tool-icon">‚úèÔ∏è</span>
                  <div class="mcp-tool-info">
                    <div class="mcp-tool-name">write_file</div>
                    <div class="mcp-tool-desc">Write content to a file</div>
                  </div>
                </div>
                <div class="mcp-tool-item" role="button" tabindex="0" onclick="invokeMCPTool('list_directory')"
                     onkeypress="if(event.key==='Enter'||event.key===' '){event.preventDefault();invokeMCPTool('list_directory')}">
                  <span class="mcp-tool-icon">üìÇ</span>
                  <div class="mcp-tool-info">
                    <div class="mcp-tool-name">list_directory</div>
                    <div class="mcp-tool-desc">List files in a directory</div>
                  </div>
                </div>
                <div class="mcp-tool-item" role="button" tabindex="0" onclick="invokeMCPTool('search_files')"
                     onkeypress="if(event.key==='Enter'||event.key===' '){event.preventDefault();invokeMCPTool('search_files')}">
                  <span class="mcp-tool-icon">üîç</span>
                  <div class="mcp-tool-info">
                    <div class="mcp-tool-name">search_files</div>
                    <div class="mcp-tool-desc">Search across project files</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Chat Panel -->
        <div class="panel" id="panel-chat">
          <div class="panel-header">
            <span>AI CHAT</span>
            <div class="panel-actions">
              <select id="chat-model-select" class="chat-model-select" title="Select model">
                <option value="gpt-4o">GPT-4o</option>
                <option value="gpt-4o-mini">GPT-4o mini</option>
                <option value="claude-3-5-sonnet-20241022">Claude 3.5</option>
                <option value="deepseek-coder">DeepSeek</option>
                <option value="llama3">Ollama</option>
              </select>
              <button class="icon-btn" onclick="toggleSystemPrompt()" title="System Prompt">‚öôÔ∏è</button>
              <button class="icon-btn" onclick="clearChat()" title="Clear Chat">üóëÔ∏è</button>
            </div>
          </div>
          <div class="chat-system-prompt hidden" id="chat-system-prompt-area">
            <textarea id="chat-system-input" class="chat-system-textarea" placeholder="System prompt (e.g. 'You are a senior JS engineer‚Ä¶')" rows="3"></textarea>
          </div>
          <div class="chat-messages" id="chat-messages">
            <div class="chat-welcome">
              <div class="chat-welcome-icon">üß†</div>
              <div class="chat-welcome-title">APEX AI</div>
              <div class="chat-welcome-text">Ask about your code. Select text in the editor and use the actions below for context-aware help.</div>
              <div class="chat-quick-actions">
                <button class="chat-quick-btn" onclick="aiAction('explain')">üìñ Explain Code</button>
                <button class="chat-quick-btn" onclick="aiAction('refactor')">‚ôªÔ∏è Refactor</button>
                <button class="chat-quick-btn" onclick="aiAction('tests')">üß™ Write Tests</button>
                <button class="chat-quick-btn" onclick="aiAction('fix')">üîß Fix Errors</button>
                <button class="chat-quick-btn" onclick="aiAction('docs')">üìù Add Docs</button>
                <button class="chat-quick-btn" onclick="aiAction('optimize')">‚ö° Optimize</button>
              </div>
            </div>
          </div>
          <div class="chat-context-row">
            <button class="chat-context-btn" onclick="askAboutCode()" title="Send selected code to chat">üìã Ask about selection</button>
            <button class="chat-context-btn" onclick="explainError()" title="Explain current error">üêõ Explain error</button>
          </div>
          <div class="chat-input-area">
            <textarea id="chat-input" class="chat-input" placeholder="Ask anything‚Ä¶ (Enter to send, Shift+Enter for new line)" rows="3" onkeydown="handleChatKey(event)"></textarea>
            <div class="chat-input-footer">
              <span class="chat-input-hint" id="chat-input-hint">Enter ‚Üµ to send</span>
              <button class="chat-send-btn" onclick="sendChatMessage()" id="chat-send-btn">Send ‚¨Ü</button>
            </div>
          </div>
        </div>

        <!-- Settings Panel -->
        <div class="panel" id="panel-settings">
          <div class="panel-header"><span>SETTINGS</span></div>
          <div class="settings-panel">
            <div class="settings-section">
              <div class="section-label">APPEARANCE</div>
              <label class="settings-row">
                <span>Theme</span>
                <select id="settings-theme" onchange="changeTheme(this.value)">
                  <option value="hiphop-dark">Hip-Hop Dark</option>
                  <option value="hiphop-light">Hip-Hop Light</option>
                  <option value="midnight">Midnight</option>
                </select>
              </label>
              <label class="settings-row">
                <span>Font Size</span>
                <input type="number" id="settings-font-size" value="14" min="10" max="24" onchange="changeFontSize(this.value)" />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">EDITOR</div>
              <label class="toggle-row">
                <span>Vim Keybindings</span>
                <input type="checkbox" class="toggle-switch" id="vim-mode" onchange="toggleVimMode(this.checked)" />
              </label>
              <label class="toggle-row">
                <span>Word Wrap</span>
                <input type="checkbox" class="toggle-switch" id="settings-word-wrap" onchange="toggleWordWrap(this.checked)" checked />
              </label>
              <label class="toggle-row">
                <span>Minimap</span>
                <input type="checkbox" class="toggle-switch" id="settings-minimap" onchange="setMinimap(this.checked)" checked />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">API KEYS</div>
              <div class="settings-note">üîí Keys are stored locally in your browser ‚Äî never sent to our servers.</div>
              <label class="settings-row">
                <span>OpenAI</span>
                <input type="password" id="settings-key-openai" placeholder="sk-‚Ä¶" onchange="updateApiKey('openai',this.value)" />
              </label>
              <label class="settings-row">
                <span>Anthropic</span>
                <input type="password" id="settings-key-anthropic" placeholder="sk-ant-‚Ä¶" onchange="updateApiKey('anthropic',this.value)" />
              </label>
              <label class="settings-row">
                <span>DeepSeek</span>
                <input type="password" id="settings-key-deepseek" placeholder="ds-‚Ä¶" onchange="updateApiKey('deepseek',this.value)" />
              </label>
              <label class="settings-row">
                <span>Ollama URL</span>
                <input type="text" id="settings-key-ollama" placeholder="http://localhost:11434" onchange="updateApiKey('ollama',this.value)" />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">MEGACODE BRIDGES</div>
              <label class="settings-row">
                <span>Bridge Port (Primary)</span>
                <input type="number" value="9742" />
              </label>
              <label class="settings-row">
                <span>Bridge Port (Secondary)</span>
                <input type="number" value="9744" />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">PERFORMANCE</div>
              <label class="toggle-row">
                <span>Lazy Modules</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
              <label class="toggle-row">
                <span>Virtual Scrolling</span>
                <input type="checkbox" class="toggle-switch" checked />
              </label>
              <label class="toggle-row">
                <span>Offline-First (Ollama)</span>
                <input type="checkbox" class="toggle-switch" />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">AUTO-SAVE</div>
              <label class="toggle-row">
                <span>Enable Auto-Save</span>
                <input type="checkbox" class="toggle-switch" id="settings-autosave" onchange="toggleAutoSave(this.checked)" checked />
              </label>
              <label class="settings-row">
                <span>Delay (ms)</span>
                <input type="number" id="settings-autosave-delay" value="1000" min="500" max="10000" step="500" onchange="setAutoSaveDelay(this.value)" />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">FOCUS &amp; WELLNESS</div>
              <label class="toggle-row">
                <span>Zen / Focus Mode</span>
                <input type="checkbox" class="toggle-switch" id="settings-zen" onchange="toggleZenMode(this.checked)" />
              </label>
              <label class="toggle-row">
                <span>Pomodoro Timer</span>
                <input type="checkbox" class="toggle-switch" id="settings-pomodoro" onchange="togglePomodoro(this.checked)" />
              </label>
              <label class="settings-row">
                <span>Work Interval (min)</span>
                <input type="number" id="settings-pomodoro-work" value="25" min="5" max="90" />
              </label>
              <label class="settings-row">
                <span>Break Interval (min)</span>
                <input type="number" id="settings-pomodoro-break" value="5" min="1" max="30" />
              </label>
              <div class="pomodoro-status" id="pomodoro-status" style="display:none">
                <span class="pomodoro-phase" id="pomodoro-phase">üçÖ Work</span>
                <span class="pomodoro-clock" id="pomodoro-clock">25:00</span>
                <button class="btn-secondary" onclick="resetPomodoro()">Reset</button>
              </div>
            </div>
            <div class="settings-section">
              <div class="section-label">NOTIFICATIONS</div>
              <label class="toggle-row">
                <span>Desktop Notifications</span>
                <input type="checkbox" class="toggle-switch" id="settings-notifs" onchange="toggleNotifications(this.checked)" />
              </label>
              <label class="toggle-row">
                <span>Sound Effects</span>
                <input type="checkbox" class="toggle-switch" id="settings-sounds" onchange="toggleSounds(this.checked)" checked />
              </label>
              <label class="toggle-row">
                <span>AI Response Chime</span>
                <input type="checkbox" class="toggle-switch" id="settings-ai-chime" onchange="toggleAIChime(this.checked)" checked />
              </label>
            </div>
            <div class="settings-section">
              <div class="section-label">SESSION</div>
              <div class="session-info-grid">
                <div class="session-info-item"><span class="session-info-label">Session Start</span><span class="session-info-val" id="si-start">‚Äî</span></div>
                <div class="session-info-item"><span class="session-info-label">Duration</span><span class="session-info-val" id="si-duration">0m</span></div>
                <div class="session-info-item"><span class="session-info-label">Lines Written</span><span class="session-info-val" id="si-lines">0</span></div>
                <div class="session-info-item"><span class="session-info-label">Saves</span><span class="session-info-val" id="si-saves">0</span></div>
              </div>
              <button class="btn-secondary" style="margin-top:8px;width:100%" onclick="resetSession()">Reset Session Stats</button>
            </div>
            <div class="settings-section">
              <div class="section-label">KEYBOARD SHORTCUTS</div>
              <div class="shortcuts-ref">
                <div class="shortcut-ref-row"><kbd>Ctrl+P</kbd><span>Command Palette</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+S</kbd><span>Save File</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+B</kbd><span>Toggle Sidebar</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+`</kbd><span>Toggle Terminal</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+Shift+F</kbd><span>Find in Files</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+Shift+J</kbd><span>AI Chat</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+Shift+C</kbd><span>CLI Runner</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+Alt+V</kbd><span>Visualizer</span></div>
                <div class="shortcut-ref-row"><kbd>Alt+E</kbd><span>Explain Code</span></div>
                <div class="shortcut-ref-row"><kbd>Alt+R</kbd><span>Refactor</span></div>
                <div class="shortcut-ref-row"><kbd>Alt+T</kbd><span>Write Tests</span></div>
                <div class="shortcut-ref-row"><kbd>Alt+F</kbd><span>Fix Errors</span></div>
                <div class="shortcut-ref-row"><kbd>Shift+Alt+F</kbd><span>Format Document</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+G</kbd><span>Go to Line</span></div>
                <div class="shortcut-ref-row"><kbd>Ctrl+M</kbd><span>Music Player</span></div>
              </div>
            </div>
            <div class="settings-section">
              <div class="section-label">UPLOADED COMPONENTS &amp; EXTENSIONS</div>
              <div class="settings-note">Folders uploaded to MCP servers and CLI instances.</div>
              <div id="settings-uploads-list" class="settings-uploads-list">
                <div class="settings-note">No folders uploaded yet.</div>
              </div>
            </div>
            <div class="settings-section">
              <div class="section-label">DEEP CUSTOMIZATION</div>
              <div class="settings-note">Fine-tune settings with JSON. Click Apply to instantly sync controls.</div>
              <textarea id="settings-deep-json" class="settings-deep-json" spellcheck="false"></textarea>
              <div class="settings-actions-row">
                <button class="btn-secondary" onclick="applyDeepCustomization()">Apply JSON</button>
                <button class="btn-secondary" onclick="loadDeepCustomizationJSON()">Reload Current</button>
              </div>
            </div>
            <div class="settings-section">
              <div class="section-label">DANGER ZONE</div>
              <button class="btn-danger" onclick="clearAllSettings()">üóëÔ∏è Clear All Settings &amp; Reset</button>
            </div>
          </div>
        </div>

        <!-- Music Player Panel -->
        <div class="panel" id="panel-music-player">
          <div class="panel-header">
            <span>MUSIC PLAYER üéµ</span>
            <div class="panel-actions">
              <button class="icon-btn" title="Upload Folder" onclick="document.getElementById('mp-folder-input').click()">üìÅ</button>
              <button class="icon-btn" title="New Playlist" onclick="mpCreatePlaylist()">‚ûï</button>
            </div>
          </div>
          <!-- Folder upload (hidden) -->
          <input type="file" id="mp-folder-input" style="display:none" webkitdirectory multiple accept="audio/*"
                 onchange="mpLoadFolder(this.files)" />

          <!-- Playlist tabs -->
          <div class="mp-playlist-bar" id="mp-playlist-bar">
            <div class="mp-playlist-tab active" data-pl="0" onclick="mpSwitchPlaylist(0, this)">All Tracks</div>
          </div>

          <!-- Track list -->
          <div class="mp-track-list" id="mp-track-list">
            <div class="mp-empty">Upload a music folder to get started üéµ</div>
          </div>

          <!-- Playback controls -->
          <div class="mp-controls">
            <div class="mp-now-playing">
              <div class="mp-album-art" id="mp-album-art">‚ô™</div>
              <div class="mp-track-info">
                <div class="mp-track-title" id="mp-track-title">No track selected</div>
                <div class="mp-track-artist" id="mp-track-artist">‚Äî</div>
              </div>
            </div>
            <div class="mp-progress-row">
              <span class="mp-time" id="mp-time-cur">0:00</span>
              <input type="range" class="mp-progress" id="mp-progress" min="0" max="100" value="0"
                     oninput="mpSeek(this.value)" />
              <span class="mp-time" id="mp-time-dur">0:00</span>
            </div>
            <div class="mp-btn-row">
              <button class="mp-btn" id="mp-shuffle-btn" onclick="mpToggleShuffle()" title="Shuffle">üîÄ</button>
              <button class="mp-btn" onclick="mpPrev()" title="Previous">‚èÆ</button>
              <button class="mp-btn mp-play" id="mp-play-btn" onclick="mpTogglePlay()" title="Play/Pause">‚ñ∂</button>
              <button class="mp-btn" onclick="mpNext()" title="Next">‚è≠</button>
              <button class="mp-btn" id="mp-repeat-btn" onclick="mpCycleRepeat()" title="Repeat">üîÅ</button>
            </div>
            <div class="mp-volume-row">
              <span class="mp-vol-icon" onclick="mpToggleMute()">üîä</span>
              <input type="range" class="mp-volume" id="mp-volume" min="0" max="100" value="80"
                     oninput="mpSetVolume(this.value)" />
            </div>
          </div>
        </div>

        <!-- Logic Mode Panel -->
        <div class="panel" id="panel-logic-mode">
          <div class="panel-header">
            <span>LOGIC MODE üß©</span>
            <div class="panel-actions">
              <button class="icon-btn" onclick="importBuildPlan()" title="Import Build Plan">‚¨á</button>
              <button class="icon-btn" onclick="clearLogicPlan()" title="Clear All Steps">üóëÔ∏è</button>
            </div>
          </div>
          <div class="logic-mode-panel">
            <div class="logic-progress-row">
              <div class="logic-progress-bar-wrap">
                <div class="logic-progress-bar" id="logic-progress-bar"></div>
              </div>
              <span class="logic-step-count" id="logic-step-count">0/0 steps</span>
            </div>
            <div class="logic-step-list" id="logic-step-list">
              <div class="logic-empty">No steps yet. Add a step or import a build plan.</div>
            </div>
            <div class="logic-add-form">
              <div class="section-label">ADD STEP</div>
              <div class="logic-add-row">
                <input type="text" class="logic-step-input" id="logic-step-input"
                       placeholder="Describe the next logic step‚Ä¶"
                       onkeydown="if(event.key==='Enter')addLogicStep()" />
                <button class="logic-add-btn" onclick="addLogicStep()" title="Add Step">+</button>
              </div>
            </div>
          </div>
        </div>

      </aside>

      <!-- MAIN EDITOR AREA -->
      <main class="editor-area" id="editor-area">
        <!-- EDITOR TABS -->
        <div class="editor-tabs" id="editor-tabs">
          <div class="tab active" data-file="welcome" onclick="openTab('welcome',this)">
            <span class="tab-icon">üè†</span>
            <span class="tab-name">Welcome</span>
            <button class="tab-close" onclick="closeTab(event,'welcome')">√ó</button>
          </div>
          <div class="tab" data-file="visualizer" onclick="openVisualizerTab()">
            <span class="tab-icon">üñ•Ô∏è</span>
            <span class="tab-name">Visualizer</span>
          </div>
          <button class="tab-add" onclick="newFile()" title="New File">+</button>
        </div>

        <!-- EDITOR PANES -->
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-bar" id="breadcrumb-bar">
          <span class="breadcrumb-item">‚¨° APEX</span>
          <span class="breadcrumb-sep">‚Ä∫</span>
          <span class="breadcrumb-item" id="breadcrumb-project">Project</span>
          <span class="breadcrumb-sep" id="breadcrumb-sep2" style="display:none">‚Ä∫</span>
          <span class="breadcrumb-item breadcrumb-file" id="breadcrumb-file" style="display:none"></span>
        </div>
        <!-- AI Toolbar -->
        <div class="ai-toolbar" id="ai-toolbar">
          <span class="ai-toolbar-label">üß† AI Actions:</span>
          <button class="ai-action-btn" onclick="aiAction('explain')" title="Explain selected code (Alt+E)">Explain</button>
          <button class="ai-action-btn" onclick="aiAction('refactor')" title="Refactor selection (Alt+R)">Refactor</button>
          <button class="ai-action-btn" onclick="aiAction('tests')" title="Generate unit tests (Alt+T)">Tests</button>
          <button class="ai-action-btn" onclick="aiAction('fix')" title="Fix errors in selection (Alt+F)">Fix</button>
          <button class="ai-action-btn" onclick="aiAction('docs')" title="Generate documentation">Docs</button>
          <div class="ai-toolbar-sep"></div>
          <button class="ai-action-btn ai-action-util" onclick="formatDocument()" title="Format Document (Shift+Alt+F)">Format</button>
          <button class="ai-action-btn ai-action-util" onclick="goToLine()" title="Go to Line (Ctrl+G)">Go to Line</button>
          <button class="ai-action-btn ai-action-util" onclick="toggleMinimap()" title="Toggle Minimap">Minimap</button>
        </div>
        <div class="editor-panes" id="editor-panes">
          <!-- Welcome Tab Content -->
          <div class="editor-pane active" id="pane-welcome">
            <div class="welcome-screen">
              <div class="welcome-hero">
                <div class="welcome-logo">‚¨°</div>
                <h1 class="welcome-title">APEX IDE</h1>
                <p class="welcome-subtitle">MEGACODE EDITION ‚Äî <em>Where Code Meets Culture</em></p>
              </div>
              <div class="welcome-grid welcome-grid-5">
                <div class="welcome-card" onclick="newFile()">
                  <div class="welcome-card-icon">üìÑ</div>
                  <div class="welcome-card-title">New File</div>
                  <div class="welcome-card-desc">Start coding something fresh</div>
                </div>
                <div class="welcome-card" onclick="openFolder()">
                  <div class="welcome-card-icon">üìÅ</div>
                  <div class="welcome-card-title">Open Folder</div>
                  <div class="welcome-card-desc">Load an existing project</div>
                </div>
                <div class="welcome-card" onclick="cloneRepo()">
                  <div class="welcome-card-icon">‚éá</div>
                  <div class="welcome-card-title">Clone Repo</div>
                  <div class="welcome-card-desc">Pull from GitHub or GitLab</div>
                </div>
                <div class="welcome-card" onclick="openCommandPalette()">
                  <div class="welcome-card-icon">‚åò</div>
                  <div class="welcome-card-title">Command Palette</div>
                  <div class="welcome-card-desc">Ctrl+P for all commands</div>
                </div>
                <div class="welcome-card" onclick="switchActivity('chat')">
                  <div class="welcome-card-icon">üí¨</div>
                  <div class="welcome-card-title">AI Chat</div>
                  <div class="welcome-card-desc">Ask your AI assistant anything</div>
                </div>
              </div>
              <div class="welcome-recents">
                <h3>Recent Projects</h3>
                <div class="recent-list" id="recent-list">
                  <div class="recent-item">
                    <span class="recent-icon">üì¶</span>
                    <div class="recent-info">
                      <div class="recent-name">Overlay365</div>
                      <div class="recent-path">~/projects/overlay365</div>
                    </div>
                  </div>
                  <div class="recent-item">
                    <span class="recent-icon">üì¶</span>
                    <div class="recent-info">
                      <div class="recent-name">Cheetah</div>
                      <div class="recent-path">~/projects/cheetah</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="welcome-shortcuts">
                <h3>Quick Keys</h3>
                <div class="shortcut-grid">
                  <span class="shortcut"><kbd>Ctrl+P</kbd> Command Palette</span>
                  <span class="shortcut"><kbd>Ctrl+`</kbd> Terminal</span>
                  <span class="shortcut"><kbd>Ctrl+B</kbd> Toggle Sidebar</span>
                  <span class="shortcut"><kbd>Ctrl+Shift+E</kbd> Explorer</span>
                  <span class="shortcut"><kbd>Ctrl+Shift+F</kbd> Search</span>
                  <span class="shortcut"><kbd>Ctrl+Shift+G</kbd> Git</span>
                  <span class="shortcut"><kbd>Ctrl+\\</kbd> Split Editor</span>
                  <span class="shortcut"><kbd>Ctrl+Z</kbd> Undo</span>
                  <span class="shortcut"><kbd>Ctrl+Shift+J</kbd> AI Chat</span>
                  <span class="shortcut"><kbd>Alt+E</kbd> Explain Code</span>
                  <span class="shortcut"><kbd>Alt+R</kbd> Refactor</span>
                  <span class="shortcut"><kbd>Alt+T</kbd> Write Tests</span>
                  <span class="shortcut"><kbd>Alt+F</kbd> Fix Errors</span>
                  <span class="shortcut"><kbd>Ctrl+G</kbd> Go to Line</span>
                  <span class="shortcut"><kbd>Shift+Alt+F</kbd> Format Doc</span>
                  <span class="shortcut"><kbd>Ctrl+D</kbd> Select Word</span>
                  <span class="shortcut"><kbd>Ctrl+Shift+L</kbd> Logic Mode</span>
                </div>
              </div>
            </div>
          </div>
          <!-- Monaco Editor Tab (for code files) -->
          <div class="editor-pane" id="pane-editor">
            <div id="monaco-container" style="width:100%;height:100%;"></div>
          </div>
          <!-- Frontend Visualizer Pane -->
          <div class="editor-pane" id="pane-visualizer">
            <div class="visualizer-toolbar">
              <span class="visualizer-label">üñ•Ô∏è FRONTEND VISUALIZER</span>
              <div class="visualizer-viewport-btns">
                <button class="viz-btn active" onclick="setVizViewport('desktop',this)" title="Desktop">üñ•Ô∏è Desktop</button>
                <button class="viz-btn" onclick="setVizViewport('tablet',this)" title="Tablet">üì± Tablet</button>
                <button class="viz-btn" onclick="setVizViewport('mobile',this)" title="Mobile">üì≤ Mobile</button>
              </div>
              <div class="visualizer-url-row">
                <input type="text" class="visualizer-url" id="visualizer-url" value="about:blank" placeholder="Enter URL or HTML to preview‚Ä¶" />
                <button class="viz-btn" onclick="loadVisualizerURL()" title="Load URL">‚ñ∂ Load</button>
                <button class="viz-btn" onclick="refreshVisualizer()" title="Refresh">‚Üª Refresh</button>
              </div>
              <div class="visualizer-html-row">
                <textarea class="visualizer-html-input" id="visualizer-html-input"
                          placeholder="Paste HTML snippet to preview‚Ä¶" rows="3"></textarea>
                <button class="viz-btn" onclick="previewHTML()" title="Preview HTML">üëÅ Preview HTML</button>
              </div>
            </div>
            <div class="visualizer-frame-wrap" id="visualizer-frame-wrap">
              <iframe class="visualizer-iframe" id="visualizer-iframe"
                      sandbox="allow-scripts"
                      title="Frontend Preview"></iframe>
            </div>
          </div>
        </div>
      </main>

      <!-- RIGHT PANELS (Vibe Layer & Monetization) -->
      <aside class="right-panel hidden" id="panel-vibe-layer">
        <div class="panel-header">
          <span>VIBE LAYER üéØ</span>
          <button class="icon-btn" onclick="togglePanel('vibe-layer')">‚úï</button>
        </div>
        <div class="vibe-panel">
          <div class="vibe-section">
            <div class="section-label">CONFIDENCE / INTENT</div>
            <div class="vibe-score-row">
              <span>Confidence</span>
              <div class="vibe-bar-wrap">
                <div class="vibe-bar" id="confidence-bar" style="width:82%"></div>
              </div>
              <span class="vibe-val" id="confidence-val">82%</span>
            </div>
            <div class="vibe-score-row">
              <span>Intent Clarity</span>
              <div class="vibe-bar-wrap">
                <div class="vibe-bar amber" id="intent-bar" style="width:71%"></div>
              </div>
              <span class="vibe-val" id="intent-val">71%</span>
            </div>
          </div>
          <div class="vibe-section">
            <div class="section-label">ONE-CLICK FIXES</div>
            <div class="fixes-queue" id="fixes-queue">
              <div class="fix-item">
                <span class="fix-icon">‚ö†Ô∏è</span>
                <span class="fix-desc">Missing null check in router.js:42</span>
                <button class="fix-btn" onclick="applyFix(this)">Fix</button>
              </div>
              <div class="fix-item">
                <span class="fix-icon">üêõ</span>
                <span class="fix-desc">Unused import in app.js:3</span>
                <button class="fix-btn" onclick="applyFix(this)">Fix</button>
              </div>
              <div class="fix-item">
                <span class="fix-icon">üí°</span>
                <span class="fix-desc">Refactor opportunity: extractFunction</span>
                <button class="fix-btn" onclick="applyFix(this)">Fix</button>
              </div>
            </div>
          </div>
          <div class="vibe-section">
            <div class="section-label">UNDO STACK</div>
            <div class="undo-stack" id="undo-stack">
              <div class="undo-item active">‚óè Current State</div>
              <div class="undo-item">‚óã Added null check (2m ago)</div>
              <div class="undo-item">‚óã Refactored router loop (5m ago)</div>
              <div class="undo-item">‚óã Initial commit (10m ago)</div>
            </div>
            <div class="undo-controls">
              <button class="btn-secondary" onclick="undoAction()">‚Ü© Undo</button>
              <button class="btn-secondary" onclick="redoAction()">‚Ü™ Redo</button>
            </div>
          </div>
          <div class="vibe-section">
            <div class="section-label">MODE</div>
            <div class="mode-toggle-row">
              <button class="mode-btn active" id="vibe-rookie" onclick="setVibeMode('rookie')">ü•ä Rookie</button>
              <button class="mode-btn" id="vibe-expert" onclick="setVibeMode('expert')">üî• Expert</button>
            </div>
          </div>
        </div>
      </aside>

      <aside class="right-panel hidden" id="panel-monetization">
        <div class="panel-header">
          <span>MONETIZATION üí∞</span>
          <button class="icon-btn" onclick="togglePanel('monetization')">‚úï</button>
        </div>
        <div class="monetization-panel">
          <div class="mono-section">
            <div class="section-label">REVENUE (TODAY)</div>
            <div class="revenue-cards">
              <div class="revenue-card">
                <div class="revenue-platform">Gumroad</div>
                <div class="revenue-amount">$142.50</div>
                <div class="revenue-delta positive">+12%</div>
              </div>
              <div class="revenue-card">
                <div class="revenue-platform">Stripe</div>
                <div class="revenue-amount">$389.00</div>
                <div class="revenue-delta positive">+8%</div>
              </div>
              <div class="revenue-card">
                <div class="revenue-platform">NFT Sales</div>
                <div class="revenue-amount">0.45 ETH</div>
                <div class="revenue-delta neutral">‚Äî</div>
              </div>
            </div>
          </div>
          <div class="mono-section">
            <div class="section-label">NFT DROP SCHEDULER</div>
            <div class="nft-scheduler">
              <input type="text" class="nft-input" placeholder="Collection name‚Ä¶" />
              <input type="datetime-local" class="nft-input" />
              <button class="btn-primary" onclick="scheduleNFTDrop()">Schedule Drop üé®</button>
            </div>
            <div class="scheduled-drops" id="scheduled-drops">
              <div class="drop-item">
                <span class="drop-name">APEX Vol.1</span>
                <span class="drop-date">Mar 1, 2026</span>
                <span class="drop-status pending">Scheduled</span>
              </div>
            </div>
          </div>
          <div class="mono-section">
            <div class="section-label">SESSION STATS</div>
            <div class="session-stats">
              <div class="stat-row"><span>Active Sessions</span><strong>247</strong></div>
              <div class="stat-row"><span>Pro Tier Users</span><strong>18</strong></div>
              <div class="stat-row"><span>Toward $500M Vision</span><strong>0.01%</strong></div>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <!-- MINI MUSIC PLAYER BAR -->
    <div class="mp-mini-bar hidden" id="mp-mini-bar">
      <div class="mp-mini-left">
        <span class="mp-mini-art">‚ô™</span>
        <div class="mp-mini-info">
          <span class="mp-mini-title" id="mp-mini-title">No track</span>
          <span class="mp-mini-artist" id="mp-mini-artist">‚Äî</span>
        </div>
      </div>
      <div class="mp-mini-center">
        <button class="mp-mini-btn" onclick="mpPrev()" title="Prev">‚èÆ</button>
        <button class="mp-mini-btn mp-mini-play" id="mp-mini-play" onclick="mpTogglePlay()" title="Play/Pause">‚ñ∂</button>
        <button class="mp-mini-btn" onclick="mpNext()" title="Next">‚è≠</button>
        <div class="mp-mini-progress-wrap">
          <div class="mp-mini-progress-fill" id="mp-mini-progress-fill"></div>
        </div>
      </div>
      <div class="mp-mini-right">
        <span class="mp-mini-time" id="mp-mini-time">0:00 / 0:00</span>
        <button class="mp-mini-btn" onclick="switchActivity('music-player')" title="Open Player">‚¨°</button>
      </div>
    </div>

    <!-- BOTTOM PANEL (Terminal) -->
    <div class="bottom-panel" id="bottom-panel">
      <div class="bottom-panel-tabs">
        <button class="bottom-tab active" onclick="switchBottomTab('terminal',this)">TERMINAL</button>
        <button class="bottom-tab" onclick="switchBottomTab('output',this)">OUTPUT</button>
        <button class="bottom-tab" onclick="switchBottomTab('problems',this)">PROBLEMS <span class="badge">3</span></button>
        <button class="bottom-tab" onclick="switchBottomTab('router-log',this)">ROUTER LOG</button>
        <div class="bottom-panel-actions">
          <button class="icon-btn" onclick="addTerminalTab()" title="New Terminal">+</button>
          <button class="icon-btn" onclick="splitTerminal()" title="Split Terminal">‚äû</button>
          <button class="icon-btn" onclick="toggleBottomPanel()" title="Close">‚úï</button>
        </div>
      </div>
      <div class="bottom-content">
        <!-- Terminal -->
        <div class="bottom-pane active" id="pane-terminal">
          <div class="terminal-tabs">
            <div class="term-tab active" onclick="switchTerminal(0,this)">bash 1</div>
            <div class="term-tab" onclick="switchTerminal(1,this)">bash 2</div>
            <div class="term-tab" onclick="switchTerminal(2,this)">megacode</div>
          </div>
          <div class="terminal-body" id="terminal-body">
            <div class="terminal-output" id="terminal-output"></div>
            <div class="terminal-input-row">
              <span class="terminal-prompt" id="terminal-prompt">apex@megacode:~$</span>
              <input type="text" class="terminal-input" id="terminal-input"
                     autocomplete="off" spellcheck="false"
                     onkeydown="handleTerminalKey(event)" />
            </div>
          </div>
        </div>
        <!-- Output -->
        <div class="bottom-pane" id="pane-output">
          <div class="output-log" id="output-log">
            <div class="log-line info">[INFO] APEX IDE initialized</div>
            <div class="log-line info">[INFO] Monaco editor loaded</div>
            <div class="log-line warn">[WARN] Ollama endpoint unreachable</div>
            <div class="log-line info">[INFO] WebSocket bridge listening on :9742</div>
          </div>
        </div>
        <!-- Problems -->
        <div class="bottom-pane" id="pane-problems">
          <div class="problems-list">
            <div class="problem-item error">
              <span class="problem-sev">‚óè</span>
              <span class="problem-file">src/router.js:42</span>
              <span class="problem-msg">TypeError: Cannot read property of null</span>
            </div>
            <div class="problem-item warning">
              <span class="problem-sev">‚óè</span>
              <span class="problem-file">src/app.js:3</span>
              <span class="problem-msg">Unused import 'lodash'</span>
            </div>
            <div class="problem-item info">
              <span class="problem-sev">‚óè</span>
              <span class="problem-file">src/app.js:120</span>
              <span class="problem-msg">Consider extracting function</span>
            </div>
          </div>
        </div>
        <!-- Router Log -->
        <div class="bottom-pane" id="pane-router-log">
          <div class="output-log" id="router-log">
            <div class="log-line info">[Router] Request ‚Üí OpenAI GPT-4o (latency: 124ms)</div>
            <div class="log-line info">[Router] Cache HIT for prompt hash #a3f2</div>
            <div class="log-line warn">[Router] DeepSeek degraded ‚Äî rerouting to Claude</div>
            <div class="log-line info">[Router] Response scored: 88/100</div>
          </div>
        </div>
      </div>
    </div>

    <!-- STATUS BAR -->
    <footer class="statusbar">
      <div class="status-left">
        <span class="status-item branch" onclick="gitBranch()">‚éá main</span>
        <span class="status-item" id="status-errors">‚úï 1  ‚ö† 2</span>
      </div>
      <div class="status-center">
        <span class="status-item" id="status-file">Welcome</span>
      </div>
      <div class="status-right">
        <span class="status-item" id="status-cursor">Ln 1, Col 1</span>
        <span class="status-item" id="status-encoding">UTF-8</span>
        <span class="status-item" id="status-lang">JavaScript</span>
        <span class="status-item megacode-badge">‚¨° MEGACODE</span>
      </div>
    </footer>
  </div>

  <!-- COMMAND PALETTE -->
  <div class="command-palette hidden" id="command-palette">
    <div class="cp-overlay" onclick="closeCommandPalette()"></div>
    <div class="cp-modal">
      <input type="text" class="cp-input" id="cp-input"
             placeholder="Type a command or search files‚Ä¶"
             oninput="filterCommands(this.value)"
             onkeydown="handleCPKey(event)" />
      <div class="cp-results" id="cp-results"></div>
    </div>
  </div>

  <!-- LOGIC MODE IMPORT MODAL -->
  <div class="logic-import-modal hidden" id="logic-import-modal">
    <div class="logic-import-overlay" onclick="closeImportModal()"></div>
    <div class="logic-import-content">
      <div class="logic-import-header">
        <span>Import Build Plan üß©</span>
        <button class="icon-btn" onclick="closeImportModal()">‚úï</button>
      </div>
      <p class="logic-import-hint">Paste a numbered or bulleted build plan. Each step will become a Logic Mode item that can be worked through individually.</p>
      <textarea class="logic-import-textarea" id="logic-import-text"
                placeholder="1. Set up project structure&#10;2. Install dependencies&#10;3. Create the main component&#10;4. Add routing&#10;5. Write tests" rows="10"
                onkeydown="if(event.key==='Escape')closeImportModal()"></textarea>
      <div class="logic-import-footer">
        <button class="btn-secondary" onclick="closeImportModal()">Cancel</button>
        <button class="btn-primary" onclick="confirmImportBuildPlan()">Import Steps üß©</button>
      </div>
    </div>
  </div>

  <script src="src/app.js"></script>
</body>
</html>
